<!DOCTYPE html>
<meta charset="utf-8">
<title>sankey-leaflet</title>

<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />

<style>
#map {
  width: 1000px;
  height: 400px;
}
#msg-box {
  position:absolute;
  top: 90px;
  left: 20px;
  font-size: 14px;
  line-height: 20px;
  padding: 5px;
  border: 1px solid black;
  font-family: sans-serif;
  background-color: white;
}
path {
  fill: none;
  stroke: #4682B4;
  stroke-opacity: 0.6;
  stroke-linecap: round;
  cursor: pointer;
}

path:hover {
  stroke-opacity: 0.8;
  stroke: #315B7E;
}
circle {
    fill-opacity: 0.3;
    cursor: pointer;
}
circle:hover{
    fill-opacity: 0.6;
}
</style>
<div id="container">
<div id="map"></div>
<div id="msg-box">Hover over nodes</div>
</div>


<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
<script src="spatialsankey.js"></script>
<script src="setmap.js"></script>
<script type="text/javascript">
    var svg = d3.select("#map").select("svg"),
        g = svg.append("g");

    var spatialsankey = d3.spatialsankey();
    
    d3.json("sfwnetwork.json", function(network) {
      d3.json("links.json", function(links) {

        spatialsankey = d3.spatialsankey()
                                .map(map)
                                .network(network)
                                .links(links);

        var node = spatialsankey.node(),
            link = spatialsankey.link(),
            linkwidth = link.width();

        var circs = g.selectAll("circle")
          .data(network.features)
          .enter()
          .append("circle")
          .attr("cx", node.cx)
          .attr("cy", node.cy)
          .attr("r", node.r)
          .style("fill", node.fill)
          .on('mouseover', node.mouseover);

        var links = g.selectAll("path")
          .data(links)
          .enter().append("path")
          .attr("d", link)
          .style("stroke-width", linkwidth);
        
        var update = function(){
            circs
              .attr("cx", node.cx)
              .attr("cy", node.cy);

            links.attr("d", link);
        };
      
        map.on("viewreset", update);
    });
  });
</script>
