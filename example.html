<!DOCTYPE html>
<meta charset="utf-8">
<title>sankey-leaflet</title>

<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />

<style>
#map {
  width: 1000px;
  height: 600px;
}

path {
  fill: none;
  stroke: steelblue;
  stroke-opacity: 0.6;
  /*stroke-width: 8px;*/
  stroke-linecap: round;
  cursor: pointer;
}

path:hover {
  stroke-opacity: 0.8;
  stroke: green;
}
circle {
    fill-opacity: 0.3;
    cursor: pointer;
}
circle:hover{
    fill-opacity: 0.8;
}
</style>

<div id="map"></div>

<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
<script src="spatialsankey.js"></script>
<script src="setmap.js"></script>
<script type="text/javascript">
    var svg = d3.select("#map").select("svg"),
        g = svg.append("g");

    var spatialsankey = d3.spatialsankey();
    
    d3.json("collection.json", function(collection) {

        spatialsankey = d3.spatialsankey()
                                .map(map)
                                .data(collection);


        var circs = g.selectAll("circle")
          .data(collection.nodes)
          .enter()
          .append("circle")
          .attr("cx", spatialsankey.node.cx)
          .attr("cy", spatialsankey.node.cy)
          .attr("r", spatialsankey.node.r)
          .style("fill", spatialsankey.node.fill);

        var link = spatialsankey.link().shift({x:0.5,y:0.8}),
            linkwidth = spatialsankey.linkwidth();

        var links = g.selectAll("path")
          .data(collection.links)
          .enter().append("path")
          .attr("d", link)
          .style("stroke-width", linkwidth);
        
        var update = function(){
            circs.attr("cx", spatialsankey.node.cx)
                  .attr("cy", spatialsankey.node.cy)
                  .attr("r", spatialsankey.node.r)
                  .style("fill", spatialsankey.node.fill);

            links.attr("d", link);

        };
      
        map.on("viewreset", update);
    });
</script>
